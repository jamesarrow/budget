<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MY BUDGET — Vision Glass v2.2</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg1:#f7f9ff;--bg2:#ffffff;--text:#111827;--muted:#6b7280;--glass:rgba(255,255,255,.6);--glass-brd:rgba(17,24,39,.06);--ring:rgba(17,24,39,.12);
    }
    body {
      font-family:'Inter',sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text);min-height:100vh;
    }
    .glass {
      backdrop-filter:blur(18px);background:var(--glass);border:1px solid var(--glass-brd);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.06);
    }
    .btn {
      display:flex;align-items:center;justify-content:flex-start;padding:.55rem .9rem;border-radius:10px;font-weight:500;font-size:0.85rem;transition:all .25s cubic-bezier(.4,0,.2,1);
      border:1px solid var(--glass-brd);background:rgba(255,255,255,.7);color:var(--text);
    }
    .btn:hover {transform:translateY(-2px);box-shadow:0 4px 10px rgba(0,0,0,.08)}
    .btn-black {background:#111827;color:#fff;border:none;}
    .btn-black:hover {filter:brightness(1.05);}
    .btn-danger {background:#ef4444;color:#fff;border:none;}
    .hover-card {transition:all .25s cubic-bezier(.4,0,.2,1)}
    .hover-card:hover {transform:translateY(-3px) scale(1.02);box-shadow:0 12px 28px rgba(0,0,0,.08)}
    .cat-pill {border:1px solid var(--glass-brd);border-radius:10px;padding:.5rem .9rem;font-size:.85rem;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1);}
    .cat-pill:hover {transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,.06)}
    .cat-pill.active {background:#111827;color:#fff;box-shadow:0 0 0 3px rgba(17,24,39,.15),0 0 12px rgba(17,24,39,.25)}
    dialog {border:none;border-radius:18px;padding:0;max-height:85vh;overflow:hidden;}
    dialog form {overflow-y:auto;max-height:85vh;}
    dialog::backdrop {background:rgba(0,0,0,.35);backdrop-filter:blur(6px)}
  </style>
</head>
<body>
  <div class="max-w-7xl mx-auto p-4 md:p-6">
    <div class="grid grid-cols-12 gap-6">
      <!-- Sidebar -->
      <aside class="col-span-12 md:col-span-3 lg:col-span-2">
        <div class="glass sidebar p-4">
          <div class="text-sm text-[color:var(--muted)] mb-1">Dashboard</div>
          <div class="text-2xl font-semibold tracking-wider mb-4">MY BUDGET</div>
          <div class="space-y-2">
            <button id="addIncomeBtn" class="btn btn-black w-full">Добавить доход</button>
            <button id="addExpenseBtn" class="btn btn-black w-full">Добавить расход</button>
            <button id="addCategoryBtn" class="btn w-full">Категории</button>
            <button id="limitsBtn" class="btn w-full">Лимиты</button>
            <button id="exportBtn" class="btn w-full">Экспорт CSV</button>
            <button id="resetBtn" class="btn btn-danger w-full">Очистить</button>
          </div>
          <div class="mt-6 text-xs text-[color:var(--muted)]">Данные сохраняются только на этом устройстве (localStorage).</div>
        </div>
      </aside>

      <!-- Main -->
      <main class="col-span-12 md:col-span-9 lg:col-span-10 space-y-6">
        <section class="grid sm:grid-cols-3 gap-4">
          <div class="glass p-5 hover-card">
            <div class="text-sm text-[color:var(--muted)]">Получено</div>
            <div id="incomeSum" class="text-3xl font-semibold mt-1">—</div>
          </div>
          <div class="glass p-5 hover-card">
            <div class="text-sm text-[color:var(--muted)]">Потрачено</div>
            <div id="expenseSum" class="text-3xl font-semibold mt-1">—</div>
          </div>
          <div class="glass p-5 hover-card">
            <div class="text-sm text-[color:var(--muted)]">Баланс месяца</div>
            <div id="balance" class="text-3xl font-semibold mt-1">—</div>
          </div>
        </section>
        <section class="glass p-5 hover-card">
          <h2 class="font-semibold mb-2">Расходы по категориям</h2>
          <canvas id="pieChart" height="160"></canvas>
        </section>
      </main>
    </div>
  </div>

  <!-- Modal: Add Entry -->
  <dialog id="modal">
    <form id="form" method="dialog" class="glass p-6 w-[92vw] max-w-lg">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-xl font-semibold">Добавить запись</h3>
        <button type="button" id="closeModal" class="btn">Закрыть</button>
      </div>
      <div class="grid gap-4">
        <input id="date" type="date" class="input" />
        <div>
          <div class="text-sm text-[color:var(--muted)] mb-2">Категория (нажми, чтобы выбрать)</div>
          <div id="categoryCardsPicker" class="flex gap-2 flex-wrap"></div>
          <button id="addCategoryInModal" type="button" class="btn mt-2">+ Новая категория</button>
        </div>
        <input id="amount" type="number" min="0" step="1000" placeholder="Сумма (VND)" class="input" />
        <input id="note" type="text" placeholder="Примечание" class="input" />
      </div>
      <div class="flex justify-end gap-3 mt-5">
        <button class="btn btn-black" id="saveBtn">Сохранить</button>
      </div>
    </form>
  </dialog>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const STORAGE_KEY = 'mybudget_entries_v6';
      const CAT_KEY = 'mybudget_categories_v6';
      let entries = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
      let categories = JSON.parse(localStorage.getItem(CAT_KEY)||'[]');
      if(categories.length===0) categories = ['еда','кофе','алкоголь','одежда','транспорт','коммуналка','развлечения','жильё','прочее'];

      const modal = document.getElementById('modal');
      const dateEl = document.getElementById('date');
      const amountEl = document.getElementById('amount');
      const noteEl = document.getElementById('note');
      const categoryCardsPicker = document.getElementById('categoryCardsPicker');
      const addIncomeBtn = document.getElementById('addIncomeBtn');
      const addExpenseBtn = document.getElementById('addExpenseBtn');
      const addCategoryInModal = document.getElementById('addCategoryInModal');
      let type='income';
      let selectedCategory = categories[0];

      const save=()=>localStorage.setItem(STORAGE_KEY,JSON.stringify(entries));
      const saveCats=()=>localStorage.setItem(CAT_KEY,JSON.stringify(categories));

      function renderCategoryPicker(){
        categoryCardsPicker.innerHTML='';
        categories.forEach(c=>{
          const pill=document.createElement('div');
          pill.className='cat-pill';
          pill.textContent=c;
          if(c===selectedCategory) pill.classList.add('active');
          pill.onclick=()=>{selectedCategory=c;renderCategoryPicker();};
          categoryCardsPicker.appendChild(pill);
        });
      }

      function openModal(setType){
        type=setType;
        dateEl.value=new Date().toISOString().slice(0,10);
        selectedCategory=categories[0];
        renderCategoryPicker();
        modal.showModal();
      }

      addIncomeBtn.onclick=()=>openModal('income');
      addExpenseBtn.onclick=()=>openModal('expense');
      document.getElementById('closeModal').onclick=()=>modal.close();
      addCategoryInModal.onclick=()=>{
        const name=prompt('Введите название новой категории');
        if(!name) return;
        categories.push(name.trim());
        saveCats();
        renderCategoryPicker();
      }

      document.getElementById('saveBtn').onclick=(e)=>{
        e.preventDefault();
        const amount=Number(amountEl.value||0);
        if(!amount) return alert('Введите сумму');
        const date=dateEl.value;
        const note=noteEl.value;
        entries.push({id:crypto.randomUUID(),type,date,category:selectedCategory,amount,note});
        save();
        modal.close();
      }
    });
  </script>
</body>
</html>